# Image Pairs (Пары изображений)

![Version](https://img.shields.io/badge/version-3.0.3-blue) ![WordPress](https://img.shields.io/badge/WordPress-5.0%2B-green) ![PHP](https://img.shields.io/badge/PHP-7.4%2B-red)

Легкий и производительный WordPress плагин для создания и вывода пар изображений (диптихов). Идеально подходит для форматов "До/После", "Процесс/Результат" или тематических подборок.

Плагин включает в себя **независимый лайтбокс**, который позволяет просматривать всю галерею целиком, даже если элементы сетки (Grid) еще не подгрузились на странице.

## Основные возможности

* **Custom Post Type:** Отдельный тип записи для пар изображений.
* **Умный Лайтбокс (v3.0):**
    * Навигация работает по "Плейлисту" (все ID выборки загружаются сразу).
    * Пользователь может листать галерею в лайтбоксе до самого конца, не прокручивая страницу сайта.
    * Данные для лайтбокса подгружаются динамически (AJAX) по мере необходимости.
* **Бесконечная прокрутка (Infinite Scroll):** Сетка изображений на странице подгружается стандартной пагинацией при скролле.
* **Производительность:**
    * Поддержка **WebP** (автоматически подставляет `.webp`, если файл существует в той же папке).
    * Native Lazy Loading (`loading="lazy"`).
    * Оптимизированные SQL-запросы.
* **Гибкие настройки:** Фильтрация по таксономии (Темам), случайный порядок (с сохранением seed для пагинации), управление подписями.
* **Админка:**
    * Удобный выбор изображений через стандартный WP Media Uploader.
    * Управление глобальными Alt-текстами прямо из карточки пары.
    * Встроенный редактор CSS для быстрой кастомизации.

## Установка

1.  Скачайте репозиторий или папку с плагином.
2.  Загрузите папку `image-pairs` в директорию `/wp-content/plugins/` вашего сайта.
3.  Активируйте плагин в меню "Плагины" в админ-панели WordPress.
4.  В меню появится новый раздел **Пары изображений**.

## Использование

### 1. Создание пар
Перейдите в **Пары изображений -> Добавить новую**.
* Выберите **Картинку 1** и **Картинку 2**.
* (Опционально) Укажите подпись.
* (Опционально) Задайте Alt-тексты (они обновят глобальные метаданные изображения).
* Выберите **Тему** (таксономия) для группировки.

### 2. Вывод на странице (Шорткод)
Используйте шорткод `[image_pairs]` в любом посте или на странице.

#### Примеры:

**Простой вывод (20 шт на страницу):**
```shortcode
[image_pairs]
```

**Вывод конкретной темы:**
```shortcode
[image_pairs topic="architecture"]
```

**Случайный порядок (Shuffle):**
```shortcode
[image_pairs shuffle="1" per_page="10"]
```
*При включенном `shuffle=1` плагин генерирует уникальную соль для сессии, чтобы при прокрутке страницы порядок оставался стабильным и пары не дублировались.*

### 3. Атрибуты шорткода

| Атрибут | По умолчанию | Описание |
| :--- | :--- | :--- |
| `topic` | *пусто* | Слаг (slug) темы или список слагов через запятую. |
| `topic_ids` | *пусто* | ID тем через запятую (приоритет над `topic`). |
| `per_page` | `20` | Количество пар на одной странице (подгрузке). |
| `orderby` | `date` | Поле сортировки: `date`, `title`, `caption`, `rand` (лучше использовать `shuffle`). |
| `order` | `DESC` | Порядок сортировки: `ASC` или `DESC`. |
| `shuffle` | `0` | `1` — Включает случайный порядок с фиксацией seed (хэша). |
| `captions` | `1` | `1` — показывать подписи, `0` — скрыть. |
| `size` | `large` | Размер изображения WP (`medium`, `large`, `full`). |
| `load_all` | `0` | `1` — Отключает пагинацию и грузит все пары сразу. |

## Технические детали

### Структура файлов
* `image-pairs.php` — Основной файл. Регистрация CPT, таксономий, AJAX-обработчиков и логика шорткода.
* `image-pairs-frontend.js` — Логика фронтенда: бесконечный скролл (IntersectionObserver) и независимый лайтбокс (Fetch API).
* `image-pairs.css` — Стили сетки и модального окна.

### Логика Лайтбокса (v3.0)
В отличие от стандартных лайтбоксов, этот не парсит DOM.
1.  При инициализации шорткод передает в `data-playlist` полный массив ID всех пар, соответствующих фильтру.
2.  При клике лайтбокс открывает текущее изображение.
3.  При нажатии "Далее": JS проверяет, есть ли данные следующей пары в локальном кэше.
    * Если есть: показывает мгновенно.
    * Если нет: делает легкий AJAX-запрос `ip_get_lightbox_data` только для этой пары.

Это позволяет иметь на странице 1000 пар, загружать в DOM только первые 20, но позволить пользователю пролистать все 1000 в лайтбоксе без задержек на рендеринг страницы.

## Кастомизация CSS
В админке доступен раздел **Пары изображений -> Настройки CSS**.
Вы можете переопределить стили без правки файлов темы. Пример:

## Примеры CSS для кастомизации

Скопируйте нужные стили и вставьте их в **Пары изображений -> Настройки CSS** в админке.

```css
/* --- 1. Светлая тема для лайтбокса --- */
/* Меняет фон на белый */
.ipbox-overlay::before {
    background: #ffffff !important;
    opacity: 0.95 !important;
}
/* Цвет стрелок и крестика делаем темным, чтобы их было видно на белом */
.ipbox-close, .ipbox-prev, .ipbox-next {
    background: rgba(0, 0, 0, 0.1);
    color: #333;
}
.ipbox-close:hover, .ipbox-prev:hover, .ipbox-next:hover {
    background: rgba(0, 0, 0, 0.2);
    color: #000;
}

/* --- 2. Стиль подписей --- */
.ip-caption {
    text-align: center;       /* Центрирование текста */
    font-size: 15px;          /* Размер шрифта */
    color: #666;              /* Цвет текста */
    font-weight: 400;         /* Толщина (обычный) */
    margin-top: 12px;         /* Отступ от картинок */
    letter-spacing: 0.5px;    /* Межбуквенный интервал */
}

/* --- 3. Оформление картинок в сетке --- */
.ip-row img {
    border-radius: 8px;                    /* Скругление углов */
    box-shadow: 0 4px 10px rgba(0,0,0,0.08); /* Легкая тень */
    transition: transform 0.3s ease;       /* Плавность анимации */
}

/* Эффект при наведении курсора */
.ip-row a:hover img {
    transform: translateY(-5px);           /* Приподнять картинку */
    opacity: 1;                            /* Убрать прозрачность */
    box-shadow: 0 8px 20px rgba(0,0,0,0.15); /* Усилить тень */
}

## Требования
* WordPress 5.0+
* PHP 7.4+

